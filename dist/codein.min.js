/*!
 * codein - version 0.1.3
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2017 Steve Ottoz
 */
(function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.Codein=c.exports}})(this,function(a){"use strict";function b(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}function c(g,h){var j=h.parentNode;j.lastChild===h?j.appendChild(g):j.insertBefore(g,h.nextSibling)}Object.defineProperty(a,"__esModule",{value:!0}),a.insertAfter=c;var d=function(){function g(h,j){for(var k=0;k<j.length;k++){var l=j[k];l.enumerable=l.enumerable,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(h,l.key,l)}}return function(h,j,k){return j&&g(h.prototype,j),k&&g(h,k),h}}(),f=function(){function g(){var h=0>=arguments.length||void 0===arguments[0]?{}:arguments[0],j=h.el,k=void 0===j?document.querySelector(".codein-input"):j,l=h.mask,m=void 0===l?document.querySelector(".codein-input-mask"):l,n=h.maskChar,o=void 0===n?0:n,p=h.max,q=void 0===p?6:p,r=h.digitClass,s=void 0===r?"digit":r,t=h.enter,u=void 0===t?function(){}:t,v=h.update,w=void 0===v?function(){}:v;b(this,g),this.el=k,this.mask=m,this.maskChar=o,this.max=~~q,this.digitClass=s,this.enter=u,this.update=w,this.init()}return d(g,[{key:"init",value:function(){return this._keydown=this.keydown.bind(this),this._input=this.input.bind(this),this._paste=this.paste.bind(this),this.el.addEventListener("keydown",this._keydown),this.el.addEventListener("keyup",this._input),this.el.addEventListener("input",this._input),this.el.addEventListener("paste",this._paste),this.unlock(),this.value=this.value,this.fillMask(),this}},{key:"lock",value:function(){return this.el.contentEditable=!1,this.el.classList.add("locked"),this}},{key:"unlock",value:function(){return this.el.contentEditable=!0,this.el.classList.remove("locked"),this}},{key:"focus",value:function(){return this.el.focus(),this}},{key:"keydown",value:function(j){var k=window.getSelection().getRangeAt(0),l=this.value,m=window.getSelection();if(this.clean(),0>[8,13,37,38,39,40,46].indexOf(j.keyCode)&&!j.metaKey&&!j.ctrlKey)if((47<j.keyCode&&58>j.keyCode||95<j.keyCode&&106>j.keyCode)&&!j.shiftKey&&("Range"===m.type&&m.baseNode.parentNode.classList.contains(this.digitClass)||l.length<this.max)){var n=j.key||j.char;k.deleteContents(),this.tokenize(n,k),j.preventDefault()}else return j.preventDefault(),!1;13===j.keyCode&&(j.preventDefault(),this.enter(this)),this.update(this),this.fillMask()}},{key:"input",value:function(j){this.update(this),this.fillMask()}},{key:"paste",value:function(j){var k=(j.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,""),l=k.split(""),m=window.getSelection().getRangeAt(0);m.deleteContents();var n=this.value.length,o=Math.max(this.max-n,0);return l.splice(o),this.tokenize(l,m),this.update(this),this.fillMask(),j.preventDefault(),!1}},{key:"fillMask",value:function(){if(this.mask){var j=this.value.split(""),k=j.length,l=" ".repeat(k)+"0".repeat(this.max-k);this.mask.innerHTML="",this.tokenize(l,this.mask)}return this}},{key:"tokenize",value:function(j,k){if(Array.isArray(j)||(j=(""+j).split("")),j.length){var l=k instanceof Range,m=k instanceof Node,n=l?k.startContainer.parentNode:document.createElement("span"),o=void 0,p=!0,q=!1,r=void 0;try{for(var t,s=j[Symbol.iterator]();!(p=(t=s.next()).done);p=!0){var u=t.value;o=document.createElement("span"),o.className=this.digitClass,o.textContent=u,l?(n.className===this.digitClass?""===n.textContent?n.parentNode.replaceChild(o,n):c(o,n):k.insertNode(o),n=o):m&&k.appendChild(o)}}catch(v){q=!0,r=v}finally{try{!p&&s.return&&s.return()}finally{if(q)throw r}}this.clean(),l&&k.setStartAfter(o)}}},{key:"clean",value:function(){var j=[].slice.call(this.el.children,0);for(var k=0;k<j.length;k++)(""===j[k].textContent||k>=this.max)&&j[k].parentNode.removeChild(j[k]);return this}},{key:"reset",value:function(){return this.el.innerHTML="",this.update(this),this.fillMask(),this}},{key:"destroy",value:function(){return this.el.removeEventListener("keydown",this._keydown),this.el.removeEventListener("keyup",this._input),this.el.removeEventListener("input",this._input),this.el.removeEventListener("paste",this._paste),this.el.textContent=this.el.textContent,this.el.contentEditable=!1,this.mask.textContent="",this}},{key:"value",set:function(j){var k=(""+j).replace(/[^0-9]/g,""),l=k.substr(0,this.max).split("");this.reset(),this.tokenize(l,this.el),this.clean(),this.update(this),this.fillMask()},get:function(){return this.el.textContent}}]),g}();a.default=f});